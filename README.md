# GL1 Programmable Compliance Toolkit

åŸºæ–¼ GL1 æ¨™æº–çš„åµŒå…¥å¼ç›£ç†æ¶æ§‹æ™ºèƒ½åˆç´„å¯¦ä½œã€‚

## åŠŸèƒ½ç‰¹è‰²

- ğŸ”’ **å¯ç¨‹å¼åˆè¦**ï¼šå°‡ KYC/AMLã€è³‡æœ¬ç®¡åˆ¶ç­‰åˆè¦é‚è¼¯æ¨¡çµ„åŒ–
- ğŸŒ **è·¨å¢ƒæ”¯ä»˜**ï¼šæ”¯æ´ FX å³æ™‚åŒ¯ç‡è½‰æ›ï¼ˆTWD, SGD, USD, CNYï¼‰
- ğŸ“œ **Repo äº¤æ˜“**ï¼šåŸå­äº¤æ›ç¢ºä¿æŠµæŠ¼å“èˆ‡ç¾é‡‘å®‰å…¨äº¤æ›
- ğŸ”— **è·¨éˆæ•´åˆ**ï¼šChainlink ACE è·¨éˆåˆè¦é©—è­‰
- ğŸ†” **èº«ä»½ç®¡ç†**ï¼šCCID è·¨éˆèº«ä»½è¨»å†Šèˆ‡ KYC é©—è­‰
- ğŸ§Š **ERC-7943 æ”¯æ´**ï¼šRWA åˆè¦æ¨™æº–ï¼Œæ”¯æ´è³‡ç”¢å‡çµèˆ‡å¼·åˆ¶è½‰å¸³
- ğŸ¦ **ERC-3643 æ”¯æ´**ï¼šT-REX å®‰å…¨ä»£å¹£æ¨™æº–ï¼ŒPBM å¯ wrap è­‰åˆ¸ä»£å¹£ï¼Œå¯¦ç¾é›™å±¤åˆè¦æ¶æ§‹

## å°ˆæ¡ˆçµæ§‹

```
contracts/
â”œâ”€â”€ interfaces/
â”‚   â”œâ”€â”€ IGL1PolicyWrapper.sol         # Policy Wrapper ä»‹é¢ï¼Œå®šç¾© wrap/unwrap æ–¹æ³•
â”‚   â”œâ”€â”€ IPolicyManager.sol            # Policy Manager ä»‹é¢ï¼Œå®šç¾©èº«ä»½é©—è­‰èˆ‡è¦å‰‡åŸ·è¡Œ
â”‚   â”œâ”€â”€ IRepoContract.sol             # Repo åˆç´„ä»‹é¢ï¼Œå®šç¾©å›è³¼å”è­°ç”Ÿå‘½é€±æœŸ
â”‚   â”œâ”€â”€ IFXRateProvider.sol           # FX åŒ¯ç‡æä¾›è€…ä»‹é¢ï¼Œå®šç¾©åŒ¯ç‡æŸ¥è©¢æ–¹æ³•
â”‚   â”œâ”€â”€ ICCIDProvider.sol             # è·¨éˆèº«ä»½æä¾›è€…ä»‹é¢
â”‚   â”œâ”€â”€ IChainlinkACE.sol             # Chainlink ACE æ•´åˆä»‹é¢
â”‚   â”œâ”€â”€ IChainlinkACEPolicyManager.sol # Chainlink ACE æ”¿ç­–ç®¡ç†ä»‹é¢
â”‚   â”œâ”€â”€ IComplianceRule.sol           # åˆè¦è¦å‰‡ä»‹é¢ï¼Œæ‰€æœ‰è¦å‰‡é ˆå¯¦ä½œæ­¤ä»‹é¢
â”‚   â”œâ”€â”€ IERC7943MultiToken.sol        # ERC-7943 RWA åˆè¦ä»‹é¢ï¼Œå®šç¾©å‡çµèˆ‡å¼·åˆ¶è½‰å¸³
â”‚   â”œâ”€â”€ IERC3643.sol                  # ERC-3643 T-REX å®‰å…¨ä»£å¹£ä»‹é¢
â”‚   â”œâ”€â”€ IIdentityRegistry.sol         # ERC-3643 èº«ä»½è¨»å†Šè¡¨ä»‹é¢
â”‚   â”œâ”€â”€ ICompliance3643.sol           # ERC-3643 åˆè¦ä»‹é¢
â”‚   â”œâ”€â”€ ITrustedIssuersRegistry.sol   # ERC-3643 å—ä¿¡ä»»ç™¼è¡Œè€…ä»‹é¢
â”‚   â””â”€â”€ IClaimTopicsRegistry.sol      # ERC-3643 Claim ä¸»é¡Œè¨»å†Šè¡¨ä»‹é¢
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ GL1PolicyWrapper.sol          # æ ¸å¿ƒåŒ…è£å™¨ï¼Œè™•ç†è³‡ç”¢ wrap/unwrap èˆ‡ FX è½‰æ›
â”‚   â”œâ”€â”€ GL1PolicyManager.sol          # æ”¿ç­–ç·¨æ’å¼•æ“ï¼Œå”èª¿èº«ä»½é©—è­‰èˆ‡å¤šæ–¹åˆè¦æª¢æŸ¥
â”‚   â”œâ”€â”€ RepoContract.sol              # å›è³¼å”è­°åˆç´„ï¼Œå¯¦ä½œåŸå­äº¤æ›èˆ‡æ¸…ç®—æµç¨‹
â”‚   â”œâ”€â”€ FXRateProvider.sol            # å¤–åŒ¯åŒ¯ç‡æä¾›è€…ï¼Œæ”¯æ´å¤šå¹£ç¨®å³æ™‚åŒ¯ç‡
â”‚   â””â”€â”€ CCIDRegistry.sol              # è·¨éˆèº«ä»½è¨»å†Šè¡¨ï¼Œç®¡ç†ç”¨æˆ¶ KYC æ†‘è­‰èˆ‡æ¨™ç±¤
â”‚
â”œâ”€â”€ rules/
â”‚   â”œâ”€â”€ WhitelistRule.sol             # ç™½åå–®è¦å‰‡ï¼Œé™åˆ¶æ”¶æ¬¾äººç‚ºé å…ˆé©—è­‰çš„å•†å®¶
â”‚   â”œâ”€â”€ CollateralRule.sol            # æŠµæŠ¼å“è¦å‰‡ï¼Œé©—è­‰ LTV èˆ‡æŠµæŠ¼å“åƒ¹å€¼
â”‚   â”œâ”€â”€ CashAdequacyRule.sol          # ç¾é‡‘å……è¶³æ€§è¦å‰‡ï¼Œé©—è­‰ Lender é¤˜é¡
â”‚   â”œâ”€â”€ FXLimitRule.sol               # å¤–åŒ¯é™é¡è¦å‰‡ï¼Œæª¢æŸ¥å–®ç­†/æ¯æ—¥äº¤æ˜“é™é¡
â”‚   â””â”€â”€ AMLThresholdRule.sol          # AML é–€æª»è¦å‰‡ï¼Œå¤§é¡äº¤æ˜“ç”³å ±èˆ‡é¢¨éšªè©•ä¼°
â”‚
â”œâ”€â”€ token/
â”‚   â”œâ”€â”€ PBMToken.sol                  # Purpose Bound Money ä»£å¹£ (ERC1155 + ERC7943)
â”‚   â””â”€â”€ ERC3643Token.sol              # ERC-3643 å®‰å…¨ä»£å¹£ (ERC20 + T-REX åˆè¦)
â”‚
â”œâ”€â”€ erc3643/
â”‚   â”œâ”€â”€ IdentityRegistry.sol          # èº«ä»½è¨»å†Šè¡¨ï¼Œæ©‹æ¥ CCIDRegistry
â”‚   â”œâ”€â”€ ComplianceModule.sol          # åˆè¦æ¨¡çµ„ï¼ˆæŒæœ‰äºº/æŒæœ‰é‡é™åˆ¶ï¼‰
â”‚   â”œâ”€â”€ TrustedIssuersRegistry.sol    # å—ä¿¡ä»» Claim ç™¼è¡Œè€…ç®¡ç†
â”‚   â””â”€â”€ ClaimTopicsRegistry.sol       # Claim ä¸»é¡Œç®¡ç†
â”‚
â”œâ”€â”€ mocks/
â”‚   â”œâ”€â”€ MockERC20.sol                 # ERC20 Mockï¼Œç”¨æ–¼æ¸¬è©¦
â”‚   â”œâ”€â”€ MockERC721.sol                # ERC721 Mockï¼Œç”¨æ–¼æ¸¬è©¦
â”‚   â”œâ”€â”€ MockERC1155.sol               # ERC1155 Mockï¼Œç”¨æ–¼æ¸¬è©¦
â”‚   â””â”€â”€ MockFXRateProvider.sol        # FX åŒ¯ç‡ Mockï¼Œç”¨æ–¼æ¸¬è©¦
â”‚
â””â”€â”€ integration/
    â””â”€â”€ ChainlinkACEIntegration.sol   # Chainlink ACE æ•´åˆåˆç´„
```

## å¿«é€Ÿé–‹å§‹

### å®‰è£ä¾è³´

```bash
npm install
```

### ç·¨è­¯åˆç´„

```bash
npx hardhat compile
```

### åŸ·è¡Œæ¸¬è©¦

```bash
npx hardhat test
```

## GL1 åˆè¦è¦å‰‡å°æ‡‰

| è¦å‰‡åˆç´„           | åŠŸèƒ½                   | GL1 å°æ‡‰ç¯„ä¾‹                    |
| ------------------ | ---------------------- | ------------------------------- |
| `WhitelistRule`    | KYC/AML ç™½åå–®æª¢æŸ¥     | Whitelisting Selected Receivers |
| `CashAdequacyRule` | ç¾é‡‘å……è¶³æ€§é©—è­‰         | Cash Adequacy Check             |
| `CollateralRule`   | æŠµæŠ¼å“åƒ¹å€¼èˆ‡ LTV é©—è­‰  | Collateral Sufficiency          |
| `FXLimitRule`      | å¤–åŒ¯äº¤æ˜“é™é¡ç®¡æ§       | FX Control Limits               |
| `AMLThresholdRule` | å¤§é¡äº¤æ˜“ç”³å ±èˆ‡é¢¨éšªè©•ä¼° | AML Large Transaction Reporting |

## ERC-7943 RWA åˆè¦æ¨™æº–

`PBMToken` å¯¦ä½œ [ERC-7943](https://eips.ethereum.org/EIPS/eip-7943)ï¼ˆUniversal Real World Asset Interfaceï¼‰ï¼Œæä¾›ç›£ç®¡ç´šåˆ¥çš„è³‡ç”¢æ§åˆ¶èƒ½åŠ›ï¼š

| åŠŸèƒ½            | æ–¹æ³•              | èªªæ˜                                             |
| --------------- | ----------------- | ------------------------------------------------ |
| ğŸ§Š è³‡ç”¢å‡çµ     | `setFrozenTokens` | å‡çµç‰¹å®šå¸³æˆ¶çš„ä»£å¹£ï¼Œé˜²æ­¢æœªæˆæ¬Šè½‰ç§»               |
| ğŸ”„ å¼·åˆ¶è½‰å¸³     | `forcedTransfer`  | ç›£ç®¡æ©Ÿæ§‹å¯å¼·åˆ¶è½‰ç§»ä»£å¹£ï¼ˆç”¨æ–¼åˆè¦åŸ·æ³•æˆ–è³‡ç”¢å›æ”¶ï¼‰ |
| âœ… äº¤æ˜“æ¬Šé™æª¢æŸ¥ | `canTransact`     | æª¢æŸ¥å¸³æˆ¶æ˜¯å¦å·²é€šé KYC/AML é©—è­‰                  |
| ğŸ” è½‰å¸³æ¬Šé™æª¢æŸ¥ | `canTransfer`     | é æª¢è½‰å¸³æ˜¯å¦ç¬¦åˆæ‰€æœ‰åˆè¦è¦å‰‡                     |
| â„ï¸ å‡çµé¤˜é¡æŸ¥è©¢ | `getFrozenTokens` | æŸ¥è©¢å¸³æˆ¶è¢«å‡çµçš„ä»£å¹£æ•¸é‡                         |

## ERC-3643 T-REX å®‰å…¨ä»£å¹£

æ¡ç”¨é›™å±¤æ¶æ§‹æ•´åˆ [ERC-3643](https://eips.ethereum.org/EIPS/eip-3643) å®‰å…¨ä»£å¹£æ¨™æº–ï¼š

| å±¤ç´š                  | æ¨™æº–      | è² è²¬                                       |
| --------------------- | --------- | ------------------------------------------ |
| **Asset Layer**       | ERC-3643  | è­‰åˆ¸ç™¼è¡Œã€å‡çµã€å¼·åˆ¶è½‰ç§»ã€KYC/AML èº«ä»½é©—è­‰ |
| **Transaction Layer** | PBM + GL1 | æ¢ä»¶å¼æ”¯ä»˜ã€Repo åŸå­äº¤æ›ã€åˆè¦è¦å‰‡å¼•æ“    |

**ERC-3643 ç‚º ERC-20 ç›¸å®¹** â†’ PBM é€é `AssetType.ERC20` è·¯å¾‘ wrap è­‰åˆ¸ä»£å¹£ â†’ ç”¨æ–¼ Repo ç­‰æ¢ä»¶å¼æ”¯ä»˜å ´æ™¯

| åŠŸèƒ½         | æ–¹æ³•                                       | èªªæ˜                                |
| ------------ | ------------------------------------------ | ----------------------------------- |
| ğŸ” åˆè¦è½‰å¸³  | `transfer` / `transferFrom`                | å…§å»º Identity + Compliance å‰ç½®æª¢æŸ¥ |
| ğŸ§Š ä»£å¹£å‡çµ  | `freezePartialTokens` / `setAddressFrozen` | éƒ¨åˆ†æˆ–æ•´å€‹éŒ¢åŒ…å‡çµ                  |
| ğŸ”„ å¼·åˆ¶è½‰å¸³  | `forcedTransfer`                           | Agent å¯å¼·åˆ¶è½‰ç§»ä»£å¹£                |
| ğŸ”‘ éŒ¢åŒ…å›å¾©  | `recoveryAddress`                          | æŠ•è³‡è€…éºå¤±ç§é‘°æ™‚è½‰ç§»ä»£å¹£åˆ°æ–°åœ°å€    |
| â¸ï¸ æš«åœ      | `pause` / `unpause`                        | æš«åœæ‰€æœ‰ä»£å¹£è½‰å¸³                    |
| ğŸ­ é‘„é€ /éŠ·æ¯€ | `mint` / `burn`                            | Agent ç®¡ç†ä»£å¹£ä¾›æ‡‰é‡                |
| ğŸ“¦ æ‰¹æ¬¡æ“ä½œ  | `batchTransfer` / `batchMint`              | æ‰¹é‡è™•ç†å¤šç­†äº¤æ˜“                    |

## æˆæ¬Š

MIT License
